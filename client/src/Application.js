import React, {Component} from 'react';

import Trip from './Trip';
import { green_btn, green_hvr, green_logo, green_hvr_logo, bg_csu_green } from './css/styling.css';

/* Renders the application.
 * Holds the destinations and options state shared with the trip.
 */
class Application extends Component {
  constructor(props) {
    super(props);
    this.state = {
      trip: { // default TFFI
        version: 3,
        type: "trip",
        title: "",
        options: {
          distance: "miles",
          userUnit: "",
          userRadius: "",
          optimization: "0.0",
          map: "svg" },
        places: [],
        distances: [],
        map: "\"<?xml version='1.0' encoding='UTF-8' standalone='yes'?><kml xmlns='http://www.opengis.net/kml/2.2' xmlns:atom='http://www.w3.org/2005/Atom' xmlns:xal='urn:oasis:names:tc:ciq:xsdschema:xAL:2.0' xmlns:gx='http://www.google.com/kml/ext/2.2'><Placemark><LineString><altitudeMode>clampToGround</altitudeMode><coordinates>3.215409994125366,36.691001892089844 15.99677,-10.520306 13.231200218199998,-8.85836982727 27.7406,-23.0339 22.408025,-22.114649 23.003057,-22.331339 23.6576,-20.9866 23.0925,-19.5323 25.031484,-17.8386 21.8057,-21.4578 -2.4000000953674316,12.267000198364258 -4.267000198364258,10.666999816894531 -0.16699999570846558,12.982999801635742 -3.490000009536743,12.458999633789062 -3.5169999599456787,11.482999801635742 13.559200286865234,7.3570098876953125 11.523500442504883,3.8360400199890137 11.553299903869629,3.722559928894043 -22.949399948120117,16.74139976501465 -25.090599060058594,17.202800750732422 -24.284700393676758,16.58839988708496 -22.888900756835938,16.136499404907227 -25.055299758911133,16.833200454711914 -24.746,14.864305555600001 -23.493499755859375,14.924500465393066 -24.4799995422,14.8850002289 -23.213699340820312,15.155900001525879 -24.33919906616211,15.045000076293945 20.635156631469727,8.427206039428711 19.08300018310547,6.300000190734863 15.786399841308594,4.2215800285339355 15.894000053405762,4.936999797821045 15.149999618530273,4.132999897003174 15.616999626159668,6.916999816894531 16.3218994140625,6.344170093536377 16.433000564575195,7.25 19.2874,11.4773 43.2439002991,-11.710800170899999 43.2719,-11.5337 13.532999992370605,-4.267000198364258 13.866999626159668,-4.2829999923706055 13.96611213684082,-4.01487398147583 13.286347,-4.223077 15.383000373840332,-1.0329999923706055 14.800000190734863,-0.8830000162124634 14.532999992370605,-0.08299999684095383 15.583000183105469,-0.017000000923871994 15.073300361633,-1.4483300447464 15.95009994506836,-0.5313500165939331 11.517000198364258,-4.0329999923706055 11.383000373840332,-3.9170000553131104 11.383000373840332,-4.150000095367432 11.88659954071045,-4.816030025482178 13.199999809265137,-3.683000087738037 12.932999610900879,-3.433000087738037 13.350000381469727,-3.683000087738037 13.817000389099121,-2.8499999046325684 18.5,3.049999952316284 18.066999435424805,1.6169999837875366 17.104403,-1.012216 12.6599,-4.20635 12.133000373840332,-3.0329999923706055 11.883000373840332,-2.7170000076293945 12.616999626159668,-3.316999912261963 12.300000190734863,-3.4830000400543213 12.366999626159668,-2.9000000953674316 12.833000183105469,-2.2170000076293945 12.133000373840332,-3.700000047683716 12.0,-3.0 12.616999626159668,-3.4830000400543213 12.883000373840332,-2.6500000953674316 12.633000373840332,-2.9000000953674316 11.649999618530273,-2.450000047683716 12.699999809265137,-2.950000047683716 12.199999809265137,-2.9830000400543213 12.866999626159668,-3.1670000553131104 12.532999992370605,-2.7170000076293945 11.949999809265137,-2.867000102996826 12.532999992370605,-2.867000102996826 12.866999626159668,-2.867000102996826 14.75,-2.5329999923706055 15.885237,-1.829403 14.532999992370605,-2.450000047683716 14.606,-2.313 15.253000259399414,-4.251699924468994 14.517000198364258,-3.950000047683716 14.232999801635742,-4.083000183105469 14.149999618530273,-4.367000102996826 14.133000373840332,2.066999912261963 18.200000762939453,-6.550000190734863 12.25,-5.75 20.850000381469727,-0.21699999272823334 18.933000564575195,0.25 20.450000762939453,-5.449999809265137 20.414891,-4.315802 21.600000381469727,-4.617000102996826 21.433000564575195,-3.4670000076293945 21.244199752807617,-7.003610134124756 21.58300018310547,-3.9170000553131104 20.590124,-4.329919 20.799999237060547,-6.4670000076293945 22.4692001343,-5.90005016327 22.382999420166016,-6.650000095367432 22.600000381469727,-6.050000190734863 22.5,-6.583000183105469 21.33300018310547,-5.349999904632568 22.399999618530273,-7.183000087738037 22.08300018310547,-4.333000183105469 22.08300018310547,-6.2170000076293945 22.0,-6.833000183105469 22.600000381469727,-7.232999801635742 22.533000946044922,-6.683000087738037 23.\n"
        + "049999237060547,-5.767000198364258 21.433000564575195,-5.5 21.149999618530273,-6.767000198364258 21.549999237060547,-4.849999904632568 23.08300018310547,-6.982999801635742 20.41699981689453,-5.9670000076293945 21.283000946044922,-4.349999904632568 22.0,-6.933000087738037 22.41699981689453,-5.9670000076293945 20.794700622558594,-6.438330173492432 25.5,0.3330000042915344 -7.566999912261963,9.5 33.20249938964844,28.89900016784668 5.621944,-1.410277 11.024394,1.685334 42.64500045776367,13.071800231933594 38.725498,9.003685 37.71699905395508,10.350000381469727 38.0,11.967000007629395 39.71139907836914,11.082500457763672 37.433998107910156,12.51990032196045 41.85419845581055,9.624699592590332 34.858001708984375,8.553999900817871 39.0059,8.7163 43.5786018372,5.93513011932 44.25299835205078,6.734000205993652 45.3334,6.9724 9.444,-0.545 11.366999626159668,-2.4000000953674316 -14.2811,10.9658 38.197566986083984,-2.7170820236206055 36.88698,2.314229 40.28998565673828,0.12532299757003784 41.849998474121094,3.933000087738037 36.187582,-0.523628 36.191218,-0.467954 36.23605728149414,-0.40255600214004517 35.18565,-1.083519 35.91752624511719,4.530250072479248 -8.138723373413086,6.045650482177734 23.907,31.861 22.7450008392334,32.54199981689453 34.53300094604492,-14.217000007629395 35.3013888889,-14.8386111111 -12.732999801635742,22.66699981689453 39.803192,-13.407165 40.602297,-12.350174 40.110719,-12.271035 40.569915,-12.201529 40.603343,-11.81741 39.654529,-12.525447 40.35490036010742,-11.361800193786621 39.052799224853516,-13.121899604797363 39.5630989074707,-11.672900199890137 39.68,-11.073 40.4702,-10.7506 40.52401351928711,-12.991762161254883 33.28094,-19.408009 37.818062,-12.288658 36.4489,-18.59 15.242899894714355,-26.687400817871094 15.533332824707031,-21.28333282470703 18.216699600219727,-23.66670036315918 15.89109992981,-24.803300857544 8.000109672546387,16.965999603271484 7.36595010757,18.7903995514 12.91919994354248,18.68670082092285 8.41496,19.066198 10.274900436401367,13.983599662780762 8.891670227050781,14.97029972076416 8.983759880065918,13.779000282287598 6.65888888889,6.20333333333 5.8177800178528,5.5961098670959 55.51029968261719,-20.887100219726562 30.1394996643,-1.9686299562499998 55.666901,-3.80222 53.6558,-5.6967 45.3046989440918,2.0144400596618652 24.066699981689453,-32.46670150756836 25.029399871826172,-31.547199249267578 26.346392,-33.391911 26.410595,-33.387799 25.899999618530273,-29.75 26.69339942932129,-27.871000289916992 29.153099060058594,-27.44029998779297 28.3982715607,-26.2494004736 28.78969955444336,-26.358999252319336 28.389999389648438,-26.510000228881836 27.595600128173828,-26.039400100708008 28.224199,-25.6539 27.9681630135,-26.352037738499998 27.777099609375,-26.69029998779297 29.25,-29.75 30.290416717529297,-28.131526947021484 30.22249984741211,-28.1830997467041 30.520000457763672,-30.6299991607666 29.498300552368164,-29.788400650024414 30.7772216796875,-24.574443817138672 29.32080078125,-23.380599975585938 30.843889236450195,-24.086666107177734 30.90916633605957,-24.108055114746094 31.29129981994629,-24.301300048828125 28.691667556762695,-26.141666412353516 29.079999923706055,-26.489999771118164 30.414199829101562,-25.103300094604492 31.5767002106,-25.4300003052 29.440200805664062,-25.684799194335938 28.816667556762695,-26.200000762939453 31.42194,-24.801985 29.209999084472656,-26.927000045776367 29.3388004303,-26.776599884 27.739721298217773,-25.726667404174805 25.474700927734375,-26.67919921875 26.9090003967,-25.7045001984 16.5333003998,-28.5750007629 24.020599365234375,-30.69219970703125 23.91972541809082,-30.63650894165039 17.2896,-30.3366 19.41309928894043,-29.141700744628906 16.8936,-28.1081 19.684493,-33.455557 18.471879959099997,-33.6494935368 18.646249771118164,-33.707637786865234 17.9692993164,-32.964099884 18.5447998046875,-31.641000747680664 19.415300369262695,-33.66310119628906 30.9595,18.0146 35.06700134277344,12.532999992370605 37.135211,-2.878109 34.886933,-1.568396 38.162974,-11.206844 34.966387,-5.831378 33.619996,-6.259359 1.153004,8.994275 10.775500297546387,33.875 10.\n"
        + "444000244140625,33.35020065307617 33.7487,3.7176 33.379279,3.044704 32.675326,-18.195092 32.853992,-18.497124 31.466999053955078,-18.183000564575195 26.716999053955078,-18.100000381469727 47.296388888900005,-11.584277777799999 68.6364974976,33.3207015991 69.239402771,33.631500244099996 90.30120086669922,22.801000595092773 91.81330108642578,22.24959945678711 91.189697265625,23.43720054626465 91.96389770507812,21.452199935913086 90.397783,23.843347 90.38269805908203,23.778799057006836 89.16079711914062,23.183799743652344 89.3165,24.8668 89.04940032958984,24.15250015258789 89.43309783935547,25.887500762939453 88.61650085449219,24.43720054626465 88.90889739990234,25.759199142456055 88.40360260009766,26.016399383544922 91.8830032349,24.416999816900002 91.8667984008789,24.963199615478516 111.63999939,28.9188995361 117.176002502,29.3386001587 97.268658,37.125286 77.7910995483,14.1492996216 81.81819915770001,17.1103992462 79.543296814,13.632499694800002 83.2245025635,17.721200943 94.22280120850002,27.985500335699996 95.33560180664062,28.066099166870117 96.1343994141,27.9412002563 77.10310363769531,28.566499710083008 76.75675,31.345138888900003 77.3374023438,23.2875003815 78.22779846191406,26.29330062866211 75.8011016846,22.7217998505 79.91860198970001,24.817199707 76.3369560242,21.857117459599998 81.2202987671,24.5034008026 75.88529968261719,23.09510040283203 80.80821990970001,23.5325139099 77.31670379639999,19.1833000183 78.4675979614,17.4531002045 78.4033966064,17.627199173 78.4298553467,17.2313175201 78.14686775210001,27.860856311 81.73390197753906,25.440099716186523 79.45079803470001,28.4221000671 77.8615,30.70645 78.18029785159999,30.189699173 82.1543651,26.7511282 83.4496994019,26.739700317399997 80.41010284423828,26.404300689697266 78.41699981689453,24.716999053955078 80.89309692382812,26.988300323486328 80.8892974854,26.7605991364 77.68241666670001,27.464233333299997 79.47370147705078,29.03339958190918 82.8592987061,25.4524002075 96.8511962890625,4.720880031585693 115.16699981689,-8.7481698989868 106.138999939,-2.16219997406 117.431999207,2.15549993515 101.4683,-2.093 110.47838,-5.80091 110.47838,-5.80091 111.302,0.5906 134.14700317382812,-6.57342004776001 131.305999756,-7.9886097908 121.661003113,-8.8492898941 137.8316,-4.3341 139.5749969482422,-7.714630126953125 137.2234,-2.9737 139.02000427246094,-1.935289978981018 139.482,-4.8557 100.37000274658203,0.8454310297966003 99.430496,1.4001 133.33299255371094,-1.5833300352096558 47.881500244141,39.60359954834 52.66666793823242,31.166667938232422 45.84709930419922,35.987701416015625 46.266666412353516,36.25 34.895,32.4530556 34.78219985961914,32.11470031738281 139.384722222,35.585555555599996 116.47166442871094,4.974722385406494 72.99690246582031,0.48813098669052124 110.60800170898438,48.6067008972168 104.150555556,48.9830555556 69.4636001586914,31.358400344848633 70.06439971923828,33.01470184326172 70.0716018677,33.902099609400004 69.57039642333984,32.3046989440918 70.89659881591797,31.909400939941406 70.48590087890625,29.961000442504883 72.851614,33.560714 68.3265,25.5448 68.3660964966,25.318099975599996 125.4788,8.9515 120.85199737548828,14.893099784851074 124.05899810791016,7.617219924926758 125.027999878,11.2276000977 121.04699707,12.361499786399998 123.84200286865234,8.178509712219238 124.611,8.41562 124.456496,8.612203 123.014999,10.7764 126.013999939,9.8591003418 125.480947495,9.755838325629998 118.49600219726562,7.013999938964844 123.341875076,8.60198349877 123.461179733,7.83073144787 122.05999755859375,6.922420024871826 51.3149986267,25.1173000336 50.851541,24.747763 41.13819885253906,30.906600952148438 37.278898,31.412413 43.4906005859375,29.626399993896484 38.731544,31.692188 40.1524,34.3905 40.17599868774414,35.285400390625 125.526000977,-8.54640007019 27.156999588,38.2924003601 29.7012996674,37.7855987549 30.368400573699997,37.8554000854 34.47179412841797,37.845069885253906 36.9035,39.813801 52.3352,24.51 52.3101,24.4756 67.85070037841797,40.308799743652344 59.296199798583984,45.15719985961914 59.22209930419922,45.09040069580078 68.93990325927734,40.\n"
        + "62350082397461 67.92780303955078,38.2489013671875 67.87560272216797,38.20940017700195 45.02880096435547,12.829500198364258 42.97629928588867,14.753000259399414 19.5987,41.895199 14.410833358764648,46.94722366333008 14.3074998856,46.6352767944 14.29555606842041,46.61805725097656 14.307845115661621,46.620018005371094 13.949712753295898,46.601768493652344 14.848055839538574,46.83250045776367 16.252222061157227,48.00027847290039 14.950799942016602,48.103599548339844 14.788056,47.952778 13.483258247375488,46.79315185546875 13.027724266052246,47.80583953857422 14.654999732971191,47.165000915527344 15.800702,46.968071 14.0083,47.478298 14.010556221,47.4799995422 12.430556297302246,47.52138900756836 11.018758773803711,46.946624755859375 13.866700172424316,47.951698303222656 9.780555725097656,47.20083236694336 4.46027994156,51.1893997192 4.421096,51.181674 4.409976005554199,51.155879974365234 4.587500095367432,51.209720611572266 4.542778015136719,51.246944427490234 4.9601898193359375,51.394798278808594 4.055833,50.943333 3.7302780151367188,51.02055740356445 3.8638899326324463,50.75559997558594 3.475559949874878,51.14419937133789 3.6172220706939697,50.926387786865234 3.4849,50.740101 3.497382,50.531611 5.577610969543457,50.65342712402344 5.20167016983,50.791900634799994 3.1960934400600003,51.2205063161 3.2511110305786133,51.185001373291016 2.8569440841674805,51.0180549621582 3.2930560112,51.32222366333 2.652780055999756,51.090301513671875 3.2566699981689453,50.85940170288086 2.755000114440918,50.93388748168945 3.1473100185394287,50.85279846191406 2.447499990463257,51.274444580078125 2.854722023010254,51.19444274902344 2.8622200489,51.198898315399994 3.148056,50.91 2.670833110809326,51.06277847290039 2.680000066757202,51.022220611572266 3.20472002029,50.817199707 2.9745644331000003,50.817279808799995 3.14055991,51.2566986 15.9035682678,44.7959367906 16.90690040588379,43.79309844970703 17.84589958190918,43.282901763916016 18.331499099731445,43.82460021972656 18.685613632202,44.438152313232 18.72480010986328,44.45869827270508 18.8083000183,44.4578018188 18.0968,44.024792 17.222826,44.8482 26.6734523,42.5440953 23.304722,43.499168 24.59040069580078,43.54819869995117 16.67140007019043,43.70029830932617 16.124399185180664,45.647499084472656 16.34280014038086,50.5619010925293 15.836899757385254,50.41419982910156 15.576700210571289,50.357200622558594 15.8452,50.253201 15.825555801391602,50.19333267211914 15.82852840423584,50.1982536315918 15.953900337219238,50.33140182495117 15.3331,50.43 16.166667938232422,50.4102783203125 15.86388874053955,50.38111114501953 16.11359977722168,50.364200592041016 15.4830556,50.5013889 15.5359084,50.549584 15.878610610961914,50.58610916137695 16.205601,50.4678 15.646400451660156,50.62419891357422 15.005556106567383,49.13916778564453 14.971099853515625,49.150299072265625 15.572221755981445,49.61083221435547 9.047152,55.81478 11.7175916,55.2109019 8.4402778,55.6077778 12.656000137329,55.617900848389 12.566769,55.696662 12.382200241088867,55.94139862060547 12.2280556,55.8855556 14.759599685668945,55.06330108642578 10.619000434899998,56.2999992371 11.5558996201,56.698898315399994 9.0125,56.011944 9.653333,55.943611 8.692492,56.020679 10.2484998703,55.756500244099996 10.3583333,56.5577778 8.986109733581543,56.82440185546875 10.9306001663,56.4425010681 9.044449806213379,56.18470001220703 8.586466,56.306223 8.441940307617188,56.39670181274414 9.124629974365234,56.29750061035156 8.31132984161377,56.50299835205078 10.036399841308594,56.50659942626953 9.93889045715332,55.77859878540039 10.613699913024902,55.88949966430664 9.172980308532715,56.550201416015625 8.353910446166992,55.9901008605957 3.215409994125366,36.691001892089844 </coordinates></LineString></Placemark></kml>\""
      }
    };
    this.updateTrip = this.updateTrip.bind(this);
    this.updateInformation = this.updateInformation.bind(this);
    this.updatePlaces = this.updatePlaces.bind(this);
    this.updateOptions = this.updateOptions.bind(this);
    this.updateOptionsUnits = this.updateOptionsUnits.bind(this);
    this.updateStartingLocation = this.updateStartingLocation.bind(this);
    this.reverseTrip = this.reverseTrip.bind(this);
    this.resetDestinations = this.resetDestinations.bind(this);
    this.placeInformation = this.placeInformation.bind(this);
  }

  updateTrip(tffi){
    console.log("updateTrip");
    console.log("TFFI " + tffi);
    this.setState({trip:tffi});
  }

  updateInformation(data, obj) {
    let newTrip = Object.assign({}, this.state.trip);
    newTrip[obj] = data;
    this.setState({trip: newTrip});
  }

  updatePlaces(place) {
    let newTrip = Object.assign({}, this.state.trip);
    newTrip.places.push(place);
    this.setState({trip : newTrip});
    console.log(this.state.trip.places);
  }

  updateOptions(opt){
    // update the options in the trip.
    let newDistance = Object.assign({}, this.state.trip);
    if(!isNaN(parseFloat(opt))){
      newDistance.options.optimization=opt;
    }else {
      newDistance.options.distance = opt;
    }

    // let newDistance = Object.assign({}, this.state.trip);
    // newDistance.options.distance = opt;
    this.setState({ trip: newDistance});
    console.log(this.state);
  }

  updateOptionsUnits(option, value) {
    let newUnit = Object.assign({}, this.state.trip);
    if (option === "userUnit") {
        newUnit.options.userUnit = value;
    } else if (option === "userRadius") {
        newUnit.options.userRadius = value;
    }

    this.setState({ trip: newUnit });
    console.log("UPDATED user units: " + JSON.stringify(this.state));
  }

  updateStartingLocation(startingIndex) {
    let newTrip = Object.assign({}, this.state.trip);

    for (let i = 0; i < startingIndex; ++i) {
      let first = newTrip.places.shift();
      newTrip.places.push(first);
      if(newTrip.distances.length !== 0) {
        let first = newTrip.distances.shift();
        newTrip.distances.push(first);
      }
    }

    this.setState({trip: newTrip});
  }


  placeInformation(item) {
    let countryName = null;
    let regionName = null;
    if("country" in item){
      if(item.country !== undefined && item.country !== "NULL"
        && item.country !== "" && item.country !== "(unassigned)"){countryName = item.country}
    }
    if("region" in item){
      if(item.region !== undefined && item.region !== "NULL"
        && item.region !== "" && item.region !== "(unassigned)"){
        regionName = item.region;
        if(countryName !== null){regionName += ", ";}
      }
    }
    return {regionName, countryName}
  }

  reverseTrip(){
    if (this.state.trip.places.length) {
      let newTrip = Object.assign({}, this.state.trip),
        startingLocation = newTrip.places.shift();
      newTrip.places = newTrip.places.reverse();
      newTrip.places.unshift(startingLocation);
      if (this.state.trip.distances.length)
        newTrip.distances = newTrip.distances.reverse();
      this.setState({trip: newTrip});
    }
  }

  resetDestinations() {
      let newTrip = Object.assign({}, this.state.trip);
      newTrip.places = [];
      newTrip.distances = [];
      newTrip.map = "<svg width=\"1920\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\"><g></g></svg>";
      this.setState({trip: newTrip});
  }

  render() {
    return(
        <div id="application">
          <Trip trip={this.state.trip} updateTrip={this.updateTrip} updateInformation={this.updateInformation}
                reverseTrip={this.reverseTrip} updateStartingLocation={this.updateStartingLocation}
                resetDestinations={this.resetDestinations} placeInformation={this.placeInformation}
                config={this.props.config} updateOptions={this.updateOptions}
                updateOptionsUnits={this.updateOptionsUnits} updatePlaces={this.updatePlaces} />
        </div>
    )
  }
}



export default Application;